import 'reflect-metadata';
import { loadConfig, InputControl, OutputControl, Logger } from '@teliagen/commons';
import { TeliagenApp } from '@teliagen/server';
import { HelloActions } from './src/modules/hello/actions/hello.actions';
{{#if playgroundEnabled}}
import { appPlugins } from './src/plugins/index';
{{/if}}
import { configDotenv } from "dotenv"
configDotenv()

export async function createApp() {
    Logger.info('App', 'Starting createApp...');
    const { config } = await loadConfig();
    Logger.info('App', 'Config loaded:', config.server?.name);

    const app = new TeliagenApp();


    // Features
    app.use(InputControl());
    app.use(OutputControl());

    // Actions
    app.registerActions(HelloActions);

{{#if playgroundEnabled}}
    await app.registerPlugins(appPlugins);
{{/if}}


    return app;
}